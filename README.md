# cs262_design3: Scale Models and Logical Clocks

### Description
In this design exercise, we contain code and results for simulating time synchronization across logical clocks in distributed systems. Our repo allows you to:

1. Spin up virtual "Machines" (gRPC servers) that simulating a real distributed system.
    - Each Machine has its own logical clock
    - Each Machine has its own incoming message queue
    - Each Machine operates on its own "clock rate"
    - Each Machine probabilistically decides an action: sending a message to its peers or an internal action
    - Each Machine updates its logical clock upon receiving a message from a peer according to Lamport's rule: ```max(self.logical_clock, message.logical_clock) + 1```
2. Run experiments in this simulation by adjusting variables in ```experiment_config.yaml```
    - Primarily ```CYCLE_MAX```, which dictates clock rate, and ```PROB_MSG_A```,```PROB_MSG_B```,```PROB_MSG_C```, which dictates the probability of different Machine actions
3. Log and parse experiment results to analyze system behavior and drift
    - Every action is logged with key details like timestamp, logical clock time, and queue length
    - Allows for visualization and analysis of how different loads and environments affect the performance of the simulated distributed system.

### Usage Instructions
1. Download the repository
2. Setup: to set up your environment, run:
```
uv sync
source .venv/bin/activate
```
3. Set experiment configs: edit ```experiment_config.yaml```. Your config choices will be automatically saved in your experiment's log folder as ```config.yaml```
4. Run experiment:
```
python main.py
```
5. Parse logs:
```
python log_parser.py <PATH_TO_LOG>
```

### System Design 

**File Structure:**
- ```main.py```: main script to run experiments, and generate logs
- ```machine.py```: contains Machine class that simulates a virtual machine with its own logical clock
- ```log_parser.py```: parses logs generated by ```main.py```
- ```analysis.py```: analyzes and plots logs parsed by ```log_parser.py```
- ```config.yaml```: config file for experiments

gRPC specific files
- ```system.proto```: defines the gRPC service interface and message schemas
- ```system_pb2.py```: auto-generated, contains classes for each message, serialization logic, and type constraints
- ```system_pb2_grpc.py```: autogenerated, contains type hints
- ```system_pb2.pyi```: auto-generated, contains stub classes and server classes

for each ```logs``` experiment folder
- ```machine_0.log```: experiment log file (also exists for machine_1, machine_2)
- ```machine_0.csv```: experiment tabular data, parsed from logs (also exists for machine_1, machine_2)
- ```clock_rates.json```: clock_rate for each machine
- ```config.yaml```: auto-generated snapshot of experiment configs